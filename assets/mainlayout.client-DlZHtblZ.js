import{a as E}from"./with-props-DchBsm47.js";import{n as e,p as I,a as o,O}from"./chunk-HA7DTUK3-BUh68AE2.js";import{X as x}from"./robin-components.es-7fcra3Mt.js";import{B as p}from"./Button-CX9LRMvc.js";import{n as y}from"./index-BG4YmgkQ.js";const P=()=>{const{sampleBrand:t}=y();return e.jsx("nav",{className:x("bg-primary-500 h-[46px] pt-1 text-center text-3xl font-bold text-black"),children:e.jsx(I,{to:"/",children:t})})};function C({isOpen:t,onClose:i,title:r,body:c,icon:n="/icons/icon-192x192.png"}){const[l,a]=o.useState(!1);o.useEffect(()=>{if(t){a(!0);const g=setTimeout(()=>{i()},5e3);return()=>clearTimeout(g)}},[t,i]);const u=()=>{a(!1),setTimeout(i,300)};return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-center p-4 sm:items-center sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm transition-opacity",onClick:u}),e.jsx("div",{className:`w-full max-w-sm transform overflow-hidden rounded-lg bg-white shadow-lg transition-all duration-300 ${l?"translate-y-0 opacity-100":"translate-y-4 opacity-0"}`,children:e.jsxs("div",{className:"relative p-4",children:[e.jsx("button",{onClick:u,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-500",children:"X"}),e.jsxs("div",{className:"flex items-start",children:[n&&e.jsx("div",{className:"mr-3 flex-shrink-0",children:e.jsx("img",{src:n||"/placeholder.svg",alt:"",className:"h-10 w-10 rounded-full"})}),e.jsxs("div",{className:"w-0 flex-1 pt-0.5",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:r}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:c})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{type:"button",className:"text-sm font-medium text-blue-600 hover:text-blue-500",onClick:u,children:"Dismiss"})})]})})]}):null}const M=t=>(console.log("Subscribing user with:",t),localStorage.setItem("push-subscription",JSON.stringify(t)),{success:!0}),T=t=>(console.log("Sending notification with message:",t),Notification.permission==="granted"&&(console.log("SENDING NOTIF"),new Notification("Test Notification",{body:"HEEEELLLOOO",icon:"/pwa-192x192.png",requireInteraction:!0})),{success:!0});function W(t){try{const i=t.trim(),r="=".repeat((4-i.length%4)%4),c=(i+r).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(c),l=new Uint8Array(n.length);for(let a=0;a<n.length;++a)l[a]=n.charCodeAt(a);return l}catch(i){throw console.error("Error converting VAPID key:",i),new Error("Invalid VAPID public key format")}}async function A(t={}){var i;try{if(!("serviceWorker"in navigator))throw new Error("Service Worker not supported");const r=await navigator.serviceWorker.ready,c=new MessageChannel;return console.log("REGISTRATION: ",r.active),(i=r.active)==null||i.postMessage({payload:{title:t.title||"Simulated Push Notification",body:t.body||"This notification was triggered by simulating a push event",icon:t.icon||"/icons/icon-192x192.png"}},[c.port2]),console.log("Push event simulation message sent to service worker"),!0}catch(r){return console.error("Error simulating push event:",r),!1}}const L=()=>{const{configTheme:t}=y(),[i,r]=o.useState("Sample notification here"),[c,n]=o.useState(!1),[l,a]=o.useState(null),[u,g]=o.useState(!1),[V,b]=o.useState(!1),[d,f]=o.useState({isOpen:!1,title:"",body:"",icon:"/pwa-192x192.png"}),h=s=>{console.log("Received message from service worker:",s.data),s.data&&s.data.type==="PUSH_RECEIVED"&&f({isOpen:!0,title:s.data.payload.title||"New Notification",body:s.data.payload.body||"You have a new notification",icon:s.data.payload.icon||"/pwa-192x192.png"})},v=()=>{navigator.serviceWorker.addEventListener("message",h)},w=async()=>{try{const m=await(await navigator.serviceWorker.register("/sw.js",{scope:"/",updateViaCache:"none"})).pushManager.getSubscription();a(m),console.log("Service Worker registered successfully")}catch(s){console.error("Service Worker registration failed:",s)}},S=async()=>{try{const m=await(await navigator.serviceWorker.ready).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:W("BOpVx8suNjpGBwTG1wzjf9UVtmsqIH33gcA42b9yUJm0XujYjJ2aOMbH0LVJc6bOT6xvj4CcakJI6iaGUA-Lg30")});a(m);const k=JSON.parse(JSON.stringify(m));await M(k)}catch(s){console.error("Failed to subscribe to push notifications:",s)}},N=async()=>{i.trim()&&l&&(await T(i),r(""))},j=async()=>{await A({title:"Simulated Push Event",body:"This notification was triggered by simulating a push event"})};return o.useEffect(()=>("serviceWorker"in navigator&&"PushManager"in window&&(n(!0),w()),g(window.matchMedia("(display-mode: standalone)").matches),b(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream),v(),()=>{navigator.serviceWorker.removeEventListener("message",h)}),[]),e.jsxs("div",{className:x("h-screen",t),children:[e.jsx(P,{}),e.jsx("input",{type:"text",value:i,onChange:s=>r(s.target.value),placeholder:"Enter notification message",className:"flex-1 rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"}),e.jsx(p,{onClick:j,children:"Simulate Push event"}),e.jsx(p,{onClick:N,children:"Send"}),e.jsx(p,{onClick:S,children:"Subscribe"}),e.jsx("main",{children:e.jsx(O,{})}),e.jsx(C,{isOpen:d.isOpen,onClose:()=>f(s=>({...s,isOpen:!1})),title:d.title,body:d.body,icon:d.icon})]})},H=E(L);export{H as default};
