import{a as w}from"./with-props-DchBsm47.js";import{n as s,p as y,a as o,O as x}from"./chunk-HA7DTUK3-BUh68AE2.js";import{X as d}from"./robin-components.es-7fcra3Mt.js";import{n as g}from"./index-BG4YmgkQ.js";const O=()=>{const{sampleBrand:e}=g();return s.jsx("nav",{className:d("bg-primary-500 h-[46px] pt-1 text-center text-3xl font-bold text-black"),children:s.jsx(y,{to:"/",children:e})})},v=e=>(console.log("Subscribing user with:",e),localStorage.setItem("push-subscription",JSON.stringify(e)),{success:!0}),I=e=>(console.log("Sending notification with message:",e),Notification.permission==="granted"&&(console.log("SENDING NOTIF"),new Notification("Test Notification",{body:"HEEEELLLOOO",icon:"/pwa-192x192.png",requireInteraction:!0})),{success:!0});function j(e){try{const t=e.trim(),l="=".repeat((4-t.length%4)%4),u=(t+l).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(u),c=new Uint8Array(n.length);for(let r=0;r<n.length;++r)c[r]=n.charCodeAt(r);return c}catch(t){throw console.error("Error converting VAPID key:",t),new Error("Invalid VAPID public key format")}}const N=()=>{const{configTheme:e}=g(),[t,l]=o.useState("HELLO"),[u,n]=o.useState(!1),[c,r]=o.useState(null),[k,p]=o.useState(!1),[E,b]=o.useState(!1),m=async()=>{try{const a=await(await navigator.serviceWorker.register("/sw.js",{scope:"/",updateViaCache:"none"})).pushManager.getSubscription();r(a),console.log("SUB: ",a),console.log("Service Worker registered successfully")}catch(i){console.error("Service Worker registration failed:",i)}},h=async()=>{try{const a=await(await navigator.serviceWorker.ready).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:j("BOpVx8suNjpGBwTG1wzjf9UVtmsqIH33gcA42b9yUJm0XujYjJ2aOMbH0LVJc6bOT6xvj4CcakJI6iaGUA-Lg30")});r(a);const S=JSON.parse(JSON.stringify(a));await v(S)}catch(i){console.error("Failed to subscribe to push notifications:",i)}},f=async()=>{console.log("HELLO"),t.trim()&&c&&(console.log("HELLO323232"),await I(t),l(""))};return o.useEffect(()=>{"serviceWorker"in navigator&&"PushManager"in window&&(n(!0),m()),p(window.matchMedia("(display-mode: standalone)").matches),b(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream)},[]),s.jsxs("div",{className:d("h-screen",e),children:[s.jsx(O,{}),s.jsx("button",{onClick:f,disabled:!t.trim(),children:"Send"}),s.jsx("button",{onClick:h,children:"Subscribe"}),s.jsx("main",{children:s.jsx(x,{})})]})},H=w(N);export{H as default};
